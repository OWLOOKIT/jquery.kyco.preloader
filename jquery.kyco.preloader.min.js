// jquery.kyco.preloader v1.1.3 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var w={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},f={init:function(d){var b=c.extend({},w,d);return this.each(function(){function d(a){a=void 0!== a?a:0;if(-1===E.indexOf(a)){E.push(a);var e=0,k=0,l=0;if(b.truePercentage){g.forEach(function(a){e+=a.fileSize});for(var c=0;c<=a;c++)k+=100*(g[c].fileSize/e),c===a-1&&(l=k)}else e=n,k=100*((a+1)/e),l=100*(a/e);x=1E3*(k-l);y(k,x)}}function s(){b.forceSequentialLoad?function e(b){var l=g[b],d=c("<img>").attr("src",z(l.node));d.load(function(){t(l);++b<g.length&&e(b)}).error(function(){t(l);++b<g.length&&e(b);f(d,l)})}(0):g.forEach(function(b){var k=c("<img>").attr("src",z(b.node));k.load(function(){t(b)}).error(function(){t(b); f(k,b)})})}function f(a,e){e.node.addClass("kyco_preloader_not_found_error");b.debugMode&&(a.attr("src")?a.attr("src"):a.css("background-image"))}function t(a){p++;b.truePercentage?(m+=100*(a.fileSize/q),p===n&&(m=100)):m=100*(p/q);y(m);b.progressiveReveal&&r(a.node);b.afterEach.call(a.node)}function y(a,e){e=void 0!==e?e:b.animateDuration;var c=0;u.stop();u.animate({width:a+"%"},{duration:e,easing:"linear",step:function(){c=A.width();B.children("span").html(Math.round(100*(u.width()/c)))},complete:function(){B.children("span").html(Math.round(a)); p===n?u.delay(100).queue(function(){b.showImagesBeforeComplete?(g.forEach(function(a){r(a.node)}),C.forEach(function(a){r(a)}),b.beforeComplete.call(this),h.animate({opacity:"0"},b.fadeOutDuration,function(){h.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this),h.animate({opacity:"0"},b.fadeOutDuration,function(){g.forEach(function(a){r(a.node)});C.forEach(function(a){r(a)});h.remove();b.onComplete.call(this)}))}):0!==m&&d(p)}})}function z(a){return"none"!==a.css("background-image")? a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function r(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var v=c(this),w=function(a){function e(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);d.push(a);0<a.children().length&&e(a)})}var d=[];0<a.children().length? (b.preloadSelector&&d.push(a),e(a)):b.preloadSelector&&d.push(a);return d}(v),g=[],C=[],p=0,n=0,m=0,q=0,F=0,x=3E3,E=[],h=c('<div id="kyco_preloader"></div>');b.showInContainer?(h.appendTo(v),v.css("position","relative"),h.css("position","absolute")):h.appendTo("body");c('<div class="kyco_loader_overlay"></div>').appendTo(h);var D=c('<div class="kyco_loader"></div>').appendTo(h),B=b.hidePercentage?c('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(D):c('<div class="kyco_progress_notification">'+ b.loaderText+' <span class="kyco_progress_percentage">'+m+"</span>%</div>").appendTo(D),A=c('<div class="kyco_progress_bar"></div>').appendTo(D),u=c('<div class="kyco_progress_loaded"></div>').appendTo(A);b.silentMode&&h.hide();b.truePercentage&&y(1,x);w.forEach(function(a){a.is("img")||"none"!==a.css("background-image")&&-1==a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===v?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image", "none"):b.useOpacity?a.css("opacity","0"):a.hide(),g.push({node:a,fileSize:0}),n++):b.hideNonImageElements&&(b.useOpacity?a.css("opacity","0"):a.hide(),C.push(a))});b.truePercentage?g.forEach(function(a){function e(){F++;F===n&&(d(),s())}c.ajax({type:"HEAD",url:z(a.node),success:function(b,c,d){a.fileSize=parseInt(d.getResponseHeader("Content-Length"));q+=a.fileSize;e()},error:function(a,d,g){e();B.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exists.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a romote domain set truePercentage to false.<br><br><button>Close</button>"); A.addClass("error");b.fadeOutDuration=5E5;c("button").click(function(){h.remove()})}})}):(q=n,d(),s())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(c,b){for(var f=0,s=this.length;f<s;f++)f in this&&c.call(b,this[f],f,this)});c.fn.kycoPreload=function(d){if(f[d])return f[d].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof d&&d)c.error("Method "+d+" does not exist on jQuery.kycoPreload");else return f.init.apply(this,arguments)}})(jQuery);
