// jquery.kyco.preloader v1.1.4 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(d){var y={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},n={init:function(g){var a=d.extend({},y,g);if(a.debugMode){var e=(new Date).getTime();console.groupCollapsed("kycoPreload"); console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": init()")}return this.each(function(){function g(b){b=void 0!==b?b:0;if(-1===F.indexOf(b)){a.debugMode&&console.groupCollapsed("trickle");F.push(b);var c=0,f=0,m=0,h=0;if(a.truePercentage)for(l.forEach(function(b){c+=b.fileSize}),h=0;h<=b;h++)f+=100*(l[h].fileSize/c),h===b-1&&(m=f);else c=q,f=100*((b+1)/c),m=100*(b/c);h=f;u=1E3*(f-m);a.debugMode&&(console.log("updating progressbar to "+h.toFixed(2)+" at "+(u/1E3).toFixed(2)+"s"),console.groupEnd()); z(h,u)}}function n(){a.debugMode&&(console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": preloading image elements..."),console.groupCollapsed("intervals"));a.forceSequentialLoad?function c(a){var m=l[a],h=d("<img>").attr("src",A(m.node));h.load(function(){v(m);++a<l.length&&c(a)}).error(function(){v(m);++a<l.length&&c(a);G(h,m)})}(0):l.forEach(function(a){var f=d("<img>").attr("src",A(a.node));f.load(function(){v(a)}).error(function(){v(a);G(f,a)})})}function G(b,a){a.node.addClass("kyco_preloader_not_found_error")} function v(b){s++;a.truePercentage?(p+=100*(b.fileSize/r),s===q&&(p=100)):p=100*(s/r);z(p);a.progressiveReveal&&t(b.node);a.afterEach.call(b.node)}function z(b,c){void 0===c&&a.debugMode&&console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": "+b.toFixed(2)+"%");c=void 0!==c?c:a.animateDuration;var f=0;w.stop();w.animate({width:b+"%"},{duration:c,easing:"linear",step:function(){f=B.width();C.children("span").html(Math.round(100*(w.width()/f)))},complete:function(){C.children("span").html(Math.round(b)); s===q?(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": preloading image elements DONE"),console.groupEnd()),w.delay(100).queue(function(){a.showImagesBeforeComplete?(l.forEach(function(a){t(a.node)}),D.forEach(function(a){t(a)}),a.beforeComplete.call(this),k.animate({opacity:"0"},a.fadeOutDuration,function(){k.remove();a.onComplete.call(this)})):(a.beforeComplete.call(this),k.animate({opacity:"0"},a.fadeOutDuration,function(){l.forEach(function(a){t(a.node)}); D.forEach(function(a){t(a)});k.remove();a.onComplete.call(this)}))})):0!==p&&g(s)}})}function A(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function t(b){a.useOpacity?b.css("opacity","1"):b.show();b.attr("data-bg")&&b.css("background-image",b.attr("data-bg"))}var x=d(this),y=function(b){function c(a){a= a.children();0<a.length&&a.each(function(){var a=d(this);f.push(a);0<a.children().length&&c(a)})}var f=[];0<b.children().length?(a.preloadSelector&&f.push(b),c(b)):a.preloadSelector&&f.push(b);return f}(x),l=[],D=[],s=0,q=0,p=0,r=0,H=0,u=3E3,F=[];a.debugMode&&console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": creating DOM elements...");var k=d('<div id="kyco_preloader"></div>');a.showInContainer?(k.appendTo(x),x.css("position","relative"),k.css("position","absolute")):k.appendTo("body");d('<div class="kyco_loader_overlay"></div>').appendTo(k); var E=d('<div class="kyco_loader"></div>').appendTo(k),C=a.hidePercentage?d('<div class="kyco_progress_notification">'+a.loaderText+"</div>").appendTo(E):d('<div class="kyco_progress_notification">'+a.loaderText+' <span class="kyco_progress_percentage">'+p+"</span>%</div>").appendTo(E),B=d('<div class="kyco_progress_bar"></div>').appendTo(E),w=d('<div class="kyco_progress_loaded"></div>').appendTo(B);a.silentMode&&k.hide();a.debugMode&&console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": creating DOM elements DONE"); a.truePercentage&&z(1,u);a.debugMode&&(console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": scanning DOM for image elements..."),console.groupCollapsed("image elements"));y.forEach(function(b){b.is("img")||"none"!==b.css("background-image")&&-1==b.css("background-image").indexOf("gradient")?(a.preloadSelector&&a.showInContainer&&b===x?a.hideBackground&&b.attr("data-bg",b.css("background-image")).css("background-image","none"):a.useOpacity?b.css("opacity","0"):b.hide(),b={node:b,fileSize:0},a.debugMode&& console.log(b.node),l.push(b),q++):a.hideNonImageElements&&(a.useOpacity?b.css("opacity","0"):b.hide(),D.push(b))});a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": scanning DOM for image elements DONE"));a.truePercentage?(a.debugMode&&(console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": getting image sizes..."),console.groupCollapsed("image sizes")),l.forEach(function(b){function c(){H++;H===q&&(g(),a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()- e)/1E3).toFixed(3)+": getting image sizes DONE")),n())}d.ajax({type:"HEAD",url:A(b.node),success:function(f,e,d){b.fileSize=parseInt(d.getResponseHeader("Content-Length"));r+=b.fileSize;a.debugMode&&console.log((b.fileSize/1E3).toFixed(2)+" KB \t"+(r/1E3).toFixed(2)+" KB total");c()},error:function(b,e,g){c();C.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exists.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a romote domain set truePercentage to false.<br><br><button>Close</button>"); B.addClass("error");a.fadeOutDuration=5E5;d("button").click(function(){k.remove()})}})})):(a.debugMode&&console.log((((new Date).getTime()-e)/1E3).toFixed(3)+": getting image sizes SKIPPED"),r=q,g(),n())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(d,a){for(var e=0,n=this.length;e<n;e++)e in this&&d.call(a,this[e],e,this)});d.fn.kycoPreload=function(g){if(n[g])return n[g].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof g&&g)d.error("Method "+g+" does not exist on jQuery.kycoPreload"); else return n.init.apply(this,arguments)}})(jQuery);
