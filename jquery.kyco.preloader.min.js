// jquery.kyco.preloader brought to you by www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var p={init:function(d){var b=c.extend({},{preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},d);return this.each(function(){function d(){k.forEach(function(a){var q=c('<img src="'+ g(a.node)+'" />'),w=!1;q.load(function(){r++;b.truePercentage?(h+=100*(a.fileSize/l),r===m&&(h=100)):h=100*(r/l);x(h);b.progressiveReveal&&n(a.node);b.afterEach.call(a.node)}).error(function(){if(!w)if(w=!0,b.debugMode){var a=q.attr("src")?q.attr("src"):q.css("background-image");0!==e.find("pre").length?c("<div>Not found: "+a+"</div>").appendTo(e.find("pre")):e.html("Failed loading images:<pre><div>Not found: "+a+"</div></pre>");e.css("text-align","left")}else e.html("failed loading one or more images... please refresh the page")})})} function x(a){var c;t.stop().animate({width:a+"%"},{duration:b.animateDuration,easing:"linear",step:function(){c=y.width();e.children("span").html(Math.round(100*(t.width()/c)))},complete:function(){e.children("span").html(Math.round(a));r===m&&t.queue(function(){b.showImagesBeforeComplete?(k.forEach(function(a){n(a.node)}),u.forEach(function(a){n(a)}),b.beforeComplete.call(this),f.animate({opacity:"0"},b.fadeOutDuration,function(){f.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this), f.animate({opacity:"0"},b.fadeOutDuration,function(){k.forEach(function(a){n(a.node)});u.forEach(function(a){n(a)});f.remove();b.onComplete.call(this)}))})}})}function g(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function n(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image", a.attr("data-bg"))}var s=c(this),p=function(a){function e(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);d.push(a);0<a.children().length&&e(a)})}var d=[];0<a.children().length?(b.preloadSelector&&d.push(a),e(a)):b.preloadSelector&&d.push(a);return d}(s),k=[],u=[],r=0,m=0,h=0,l=0,f=c('<div id="kyco_preloader"></div>');b.showInContainer?(f.appendTo(s),s.css("position","relative"),f.css("position","absolute")):f.appendTo("body");c('<div class="kyco_loader_overlay"></div>').appendTo(f); var v=c('<div class="kyco_loader"></div>').appendTo(f),e=b.hidePercentage?c('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(v):c('<div class="kyco_progress_notification">'+b.loaderText+' <span class="kyco_progress_percentage">'+h+"</span>%</div>").appendTo(v),y=c('<div class="kyco_progress_bar"></div>').appendTo(v),t=c('<div class="kyco_progress_loaded"></div>').appendTo(y);b.silentMode&&f.hide();p.forEach(function(a){a.is("img")||"none"!==a.css("background-image")&&-1== a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===s?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"):b.useOpacity?a.css("opacity","0"):a.hide(),k.push({node:a,fileSize:0}),m++):b.hideNonImageElements&&(b.useOpacity?a.css("opacity","0"):a.hide(),u.push(a))});if(b.truePercentage){var z=0;k.forEach(function(a){c.ajax({type:"HEAD",url:g(a.node),success:function(b,c,e){a.fileSize=parseInt(e.getResponseHeader("Content-Length")); l+=parseInt(e.getResponseHeader("Content-Length"));z++;z===m&&d()},error:function(d,f,x){b.debugMode?(404===d.status?0!==e.find("pre").length?c("<div>Not found: "+g(a.node)+"</div>").appendTo(e.find("pre")):e.html("Failed loading images:<pre><div>Not found: "+g(a.node)+"</div></pre>"):0===d.status?0!==e.find("pre").length?c("<div>Invalid cross-domain call: "+g(a.node)+"</div>").appendTo(e.find("pre")):e.html("Failed loading images:<pre><div>Invalid cross-domain call: "+g(a.node)+"</div></pre>"):0!== e.find("pre").length?c("<div>Couldn't get file size, set {truePercentage: false}</div>").appendTo(e.find("pre")):e.html("Failed loading images:<pre><div>Couldn't get file size, set {truePercentage: false}</div></pre>"),e.css("text-align","left")):e.html("failed loading one or more images... please refresh the page")}})})}else l=m,d()})}};c.fn.kycoPreload=function(d){"forEach"in Array.prototype||(Array.prototype.forEach=function(b,c){for(var d=0,g=this.length;d<g;d++)d in this&&b.call(c,this[d],d, this)});if(p[d])return p[d].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof d&&d)c.error("Method "+d+" does not exist on jQuery.kycoPreload");else return p.init.apply(this,arguments)}})(jQuery);