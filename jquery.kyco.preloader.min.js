// jquery.kyco.preloader brought to you by www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var h={init:function(e){var b=c.extend({},{preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,progressiveReveal:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,beforeComplete:function(){},onComplete:function(){}},e);return this.each(function(){function e(){k.forEach(function(a){var m=c('<img src="'+j(a.node)+'" />'),e=!1;m.load(function(){q++; var c=r=b.truePercentage?r+Math.round(100*(a.fileSize/l)):Math.round(100*(q/l)),e=u.width();s.stop().animate({width:c+"%"},{duration:b.animateDuration,easing:"linear",step:function(){d.children("span").html(Math.round(100*(s.width()/e)))},complete:function(){d.children("span").html(100);q===n&&s.queue(function(){b.showImagesBeforeComplete?(k.forEach(function(a){h(a.node)}),b.beforeComplete.call(this),f.animate({opacity:"0"},b.fadeOutDuration,function(){f.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this), f.animate({opacity:"0"},b.fadeOutDuration,function(){k.forEach(function(a){h(a.node)});f.remove();b.onComplete.call(this)}))})}});b.progressiveReveal&&h(a.node)}).error(function(){if(!e)if(e=!0,b.debugMode){var a=m.attr("src")?m.attr("src"):m.css("background-image");0!==d.find("pre").length?c("<div>Not found: "+a+"</div>").appendTo(d.find("pre")):d.html("Failed loading images:<pre><div>Not found: "+a+"</div></pre>");d.css("text-align","left")}else d.html("failed loading one or more images... please refresh the page")})})} function j(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function h(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var g=c(this),v,w=function(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);p.push(a);0<a.children().length&& w(a)})},p=[];0<g.children().length?(b.preloadSelector&&p.push(g),w(g)):b.preloadSelector&&p.push(g);v=p;var k=[],q=0,n=0,r=0,l=0,f=c('<div id="kyco_preloader"></div>');b.showInContainer?(f.appendTo(g),g.css("position","relative"),f.css("position","absolute")):f.appendTo("body");c('<div class="kyco_loader_overlay"></div>').appendTo(f);var t=c('<div class="kyco_loader"></div>').appendTo(f),d=b.hidePercentage?c('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(t):c('<div class="kyco_progress_notification">'+ b.loaderText+' <span class="kyco_progress_percentage">'+r+"</span>%</div>").appendTo(t),u=c('<div class="kyco_progress_bar"></div>').appendTo(t),s=c('<div class="kyco_progress_loaded"></div>').appendTo(u);b.silentMode&&f.hide();v.forEach(function(a){if(a.is("img")||"none"!==a.css("background-image"))!b.preloadSelector||!(b.showInContainer&&a===g)?b.useOpacity?a.css("opacity","0"):a.hide():b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"),k.push({node:a,fileSize:0}), n++});if(b.truePercentage){var x=0;k.forEach(function(a){c.ajax({type:"HEAD",url:j(a.node),success:function(b,c,d){a.fileSize=parseInt(d.getResponseHeader("Content-Length"));l+=parseInt(d.getResponseHeader("Content-Length"));x++;x===n&&e()},error:function(e){b.debugMode?(404===e.status?0!==d.find("pre").length?c("<div>Not found: "+j(a.node)+"</div>").appendTo(d.find("pre")):d.html("Failed loading images:<pre><div>Not found: "+j(a.node)+"</div></pre>"):0===e.status?0!==d.find("pre").length?c("<div>Invalid cross-domain call: "+ j(a.node)+"</div>").appendTo(d.find("pre")):d.html("Failed loading images:<pre><div>Invalid cross-domain call: "+j(a.node)+"</div></pre>"):0!==d.find("pre").length?c("<div>Couldn't get file size, set {truePercentage: false}</div>").appendTo(d.find("pre")):d.html("Failed loading images:<pre><div>Couldn't get file size, set {truePercentage: false}</div></pre>"),d.css("text-align","left")):d.html("failed loading one or more images... please refresh the page")}})})}else l=n,e()})}};c.fn.kycoPreload=function(e){if(h[e])return h[e].apply(this, Array.prototype.slice.call(arguments,1));if("object"===typeof e||!e)return h.init.apply(this,arguments);c.error("Method "+e+" does not exist on jQuery.kycoPreload")}})(jQuery);