// jquery.kyco.preloader v1.1.0 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(d){var t={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},g={init:function(c){var b=d.extend({},t,c);return this.each(function(){function c(){b.forceSequentialLoad? function A(b){var c=f[b],e=d("<img>").attr("src",u(c.node));e.load(function(){p(c);++b<f.length&&A(b)}).error(function(){p(c);++b<f.length&&A(b);B(e,c)})}(0):f.forEach(function(b){var n=d("<img>").attr("src",u(b.node));n.load(function(){p(b)}).error(function(){p(b);B(n,b)})})}function B(a,c){c.node.addClass("kyco_preloader_not_found_error");if(b.debugMode){var n=a.attr("src")?a.attr("src"):a.css("background-image");console.log("Failed loading "+n)}}function p(a){q++;b.truePercentage?(h+=100*(a.fileSize/ l),q===k&&(h=100)):h=100*(q/l);g(h);b.progressiveReveal&&m(a.node);b.afterEach.call(a.node)}function g(a){var c;v.stop().animate({width:a+"%"},{duration:b.animateDuration,easing:"linear",step:function(){c=w.width();x.children("span").html(Math.round(100*(v.width()/c)))},complete:function(){x.children("span").html(Math.round(a));q===k&&v.queue(function(){b.showImagesBeforeComplete?(f.forEach(function(a){m(a.node)}),y.forEach(function(a){m(a)}),b.beforeComplete.call(this),e.animate({opacity:"0"},b.fadeOutDuration, function(){e.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this),e.animate({opacity:"0"},b.fadeOutDuration,function(){f.forEach(function(a){m(a.node)});y.forEach(function(a){m(a)});e.remove();b.onComplete.call(this)}))})}})}function u(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")} function m(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var r=d(this),t=function(a){function c(a){a=a.children();0<a.length&&a.each(function(){var a=d(this);e.push(a);0<a.children().length&&c(a)})}var e=[];0<a.children().length?(b.preloadSelector&&e.push(a),c(a)):b.preloadSelector&&e.push(a);return e}(r),f=[],y=[],q=0,k=0,h=0,l=0,s=0,e=d('<div id="kyco_preloader"></div>');b.showInContainer?(e.appendTo(r),r.css("position","relative"), e.css("position","absolute")):e.appendTo("body");d('<div class="kyco_loader_overlay"></div>').appendTo(e);var z=d('<div class="kyco_loader"></div>').appendTo(e),x=b.hidePercentage?d('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(z):d('<div class="kyco_progress_notification">'+b.loaderText+' <span class="kyco_progress_percentage">'+h+"</span>%</div>").appendTo(z),w=d('<div class="kyco_progress_bar"></div>').appendTo(z),v=d('<div class="kyco_progress_loaded"></div>').appendTo(w); b.silentMode&&e.hide();t.forEach(function(a){a.is("img")||"none"!==a.css("background-image")&&-1==a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===r?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"):b.useOpacity?a.css("opacity","0"):a.hide(),f.push({node:a,fileSize:0}),k++):b.hideNonImageElements&&(b.useOpacity?a.css("opacity","0"):a.hide(),y.push(a))});b.truePercentage?f.forEach(function(a){d.ajax({type:"HEAD",url:u(a.node), success:function(b,e,d){a.fileSize=parseInt(d.getResponseHeader("Content-Length"));l+=a.fileSize;s++;s===k&&c()},error:function(a,e,d){s++;s===k&&c();x.addClass("error").html("Your images were not preloaded!<br>Possible errors: Loader failed getting image sizes.<br>Make sure you load images from the same domain or set truePercentage to false.");w.addClass("error");b.fadeOutDuration=5E4}})}):(l=k,c())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(c,b){for(var d=0,g=this.length;d< g;d++)d in this&&c.call(b,this[d],d,this)});d.fn.kycoPreload=function(c){if(g[c])return g[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof c&&c)d.error("Method "+c+" does not exist on jQuery.kycoPreload");else return g.init.apply(this,arguments)}})(jQuery);
