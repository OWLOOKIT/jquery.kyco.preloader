// jquery.kyco.preloader v1.1.2 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(d){(new Date).getTime();var t={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},h={init:function(c){var b=d.extend({},t,c);return this.each(function(){function c(){b.forceSequentialLoad? function A(b){var n=f[b],c=d("<img>").attr("src",u(n.node));c.load(function(){p(n);++b<f.length&&A(b)}).error(function(){p(n);++b<f.length&&A(b);B(c,n)})}(0):f.forEach(function(b){var c=d("<img>").attr("src",u(b.node));c.load(function(){p(b)}).error(function(){p(b);B(c,b)})})}function B(a,c){c.node.addClass("kyco_preloader_not_found_error");b.debugMode&&(a.attr("src")?a.attr("src"):a.css("background-image"))}function p(a){q++;b.truePercentage?(g+=100*(a.fileSize/l),q===k&&(g=100)):g=100*(q/l);h(g); b.progressiveReveal&&m(a.node);b.afterEach.call(a.node)}function h(a,c){c=void 0!==c?c:b.animateDuration;var d;v.stop().animate({width:a+"%"},{duration:c,easing:"linear",step:function(){d=w.width();x.children("span").html(Math.round(100*(v.width()/d)))},complete:function(){x.children("span").html(Math.round(a));q===k&&v.delay(100).queue(function(){b.showImagesBeforeComplete?(f.forEach(function(a){m(a.node)}),y.forEach(function(a){m(a)}),b.beforeComplete.call(this),e.animate({opacity:"0"},b.fadeOutDuration, function(){e.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this),e.animate({opacity:"0"},b.fadeOutDuration,function(){f.forEach(function(a){m(a.node)});y.forEach(function(a){m(a)});e.remove();b.onComplete.call(this)}))})}})}function u(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")} function m(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var r=d(this),t=function(a){function c(a){a=a.children();0<a.length&&a.each(function(){var a=d(this);e.push(a);0<a.children().length&&c(a)})}var e=[];0<a.children().length?(b.preloadSelector&&e.push(a),c(a)):b.preloadSelector&&e.push(a);return e}(r),f=[],y=[],q=0,k=0,g=0,l=0,s=0,e=d('<div id="kyco_preloader"></div>');b.showInContainer?(e.appendTo(r),r.css("position","relative"), e.css("position","absolute")):e.appendTo("body");d('<div class="kyco_loader_overlay"></div>').appendTo(e);var z=d('<div class="kyco_loader"></div>').appendTo(e),x=b.hidePercentage?d('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(z):d('<div class="kyco_progress_notification">'+b.loaderText+' <span class="kyco_progress_percentage">'+g+"</span>%</div>").appendTo(z),w=d('<div class="kyco_progress_bar"></div>').appendTo(z),v=d('<div class="kyco_progress_loaded"></div>').appendTo(w); b.silentMode&&e.hide();t.forEach(function(a){a.is("img")||"none"!==a.css("background-image")&&-1==a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===r?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"):b.useOpacity?a.css("opacity","0"):a.hide(),f.push({node:a,fileSize:0}),k++):b.hideNonImageElements&&(b.useOpacity?a.css("opacity","0"):a.hide(),y.push(a))});b.truePercentage?f.forEach(function(a){d.ajax({type:"HEAD",url:u(a.node), success:function(b,d,e){a.fileSize=parseInt(e.getResponseHeader("Content-Length"));l+=a.fileSize;s++;s===k&&c()},error:function(a,f,g){s++;s===k&&c();x.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exists.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a romote domain set truePercentage to false.<br><br><button>Close</button>");w.addClass("error");b.fadeOutDuration=5E5;d("button").click(function(){e.remove()})}})}): (l=k,c())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(c,b){for(var d=0,h=this.length;d<h;d++)d in this&&c.call(b,this[d],d,this)});d.fn.kycoPreload=function(c){if(h[c])return h[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof c&&c)d.error("Method "+c+" does not exist on jQuery.kycoPreload");else return h.init.apply(this,arguments)}})(jQuery);
