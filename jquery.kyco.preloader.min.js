// jquery.kyco.preloader v1.1.1 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var u={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},g={init:function(d){var b=c.extend({},u,d);return this.each(function(){function d(a){a=void 0!== a?a:0;var b=0,e=0;f.forEach(function(a){b+=a.fileSize});for(var k=0;k<=a;k++)e+=100*(f[k].fileSize/b);v=1E3*e;w(e,v)}function r(){b.forceSequentialLoad?function D(b){var k=f[b],d=c("<img>").attr("src",x(k.node));d.load(function(){s(k);++b<f.length&&D(b)}).error(function(){s(k);++b<f.length&&D(b);g(d,k)})}(0):f.forEach(function(b){var e=c("<img>").attr("src",x(b.node));e.load(function(){s(b)}).error(function(){s(b);g(e,b)})})}function g(a,c){c.node.addClass("kyco_preloader_not_found_error");if(b.debugMode){var e= a.attr("src")?a.attr("src"):a.css("background-image");console.log("Failed loading "+e)}}function s(a){m++;b.truePercentage?(l+=100*(a.fileSize/n),m===p&&(l=100)):l=100*(m/n);w(l);b.progressiveReveal&&q(a.node);b.afterEach.call(a.node)}function w(a,c){c=void 0!==c?c:b.animateDuration;var e;y.stop().animate({width:a+"%"},{duration:c,easing:"linear",step:function(){e=z.width();A.children("span").html(Math.round(100*(y.width()/e)))},complete:function(){A.children("span").html(Math.round(a));m===p?y.delay(100).queue(function(){b.showImagesBeforeComplete? (f.forEach(function(a){q(a.node)}),B.forEach(function(a){q(a)}),b.beforeComplete.call(this),h.animate({opacity:"0"},b.fadeOutDuration,function(){h.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this),h.animate({opacity:"0"},b.fadeOutDuration,function(){f.forEach(function(a){q(a.node)});B.forEach(function(a){q(a)});h.remove();b.onComplete.call(this)}))}):b.truePercentage&&d(m+1)}})}function x(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/, ""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function q(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var t=c(this),u=function(a){function d(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);e.push(a);0<a.children().length&&d(a)})}var e=[];0<a.children().length?(b.preloadSelector&&e.push(a),d(a)):b.preloadSelector&&e.push(a);return e}(t), f=[],B=[],m=0,p=0,l=0,n=0,E=0,v=3E3,h=c('<div id="kyco_preloader"></div>');b.showInContainer?(h.appendTo(t),t.css("position","relative"),h.css("position","absolute")):h.appendTo("body");c('<div class="kyco_loader_overlay"></div>').appendTo(h);var C=c('<div class="kyco_loader"></div>').appendTo(h),A=b.hidePercentage?c('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(C):c('<div class="kyco_progress_notification">'+b.loaderText+' <span class="kyco_progress_percentage">'+l+"</span>%</div>").appendTo(C), z=c('<div class="kyco_progress_bar"></div>').appendTo(C),y=c('<div class="kyco_progress_loaded"></div>').appendTo(z);b.silentMode&&h.hide();b.truePercentage&&w(1,v);u.forEach(function(a){a.is("img")||"none"!==a.css("background-image")&&-1==a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===t?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"):b.useOpacity?a.css("opacity","0"):a.hide(),f.push({node:a,fileSize:0}),p++):b.hideNonImageElements&& (b.useOpacity?a.css("opacity","0"):a.hide(),B.push(a))});b.truePercentage?f.forEach(function(a){function f(){E++;E===p&&(d(),r())}c.ajax({type:"HEAD",url:x(a.node),success:function(b,c,d){a.fileSize=parseInt(d.getResponseHeader("Content-Length"));n+=a.fileSize;f()},error:function(a,d,l){f();A.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exists.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a romote domain set truePercentage to false.<br><br><button>Close</button>"); z.addClass("error");b.fadeOutDuration=5E5;c("button").click(function(){h.remove()})}})}):(n=p,r())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(c,b){for(var g=0,r=this.length;g<r;g++)g in this&&c.call(b,this[g],g,this)});c.fn.kycoPreload=function(d){if(g[d])return g[d].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof d&&d)c.error("Method "+d+" does not exist on jQuery.kycoPreload");else return g.init.apply(this,arguments)}})(jQuery);
