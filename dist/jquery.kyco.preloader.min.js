/***************************************\

	jquery.kyco.preloader
	=====================

	Version 1.2.0

	Brought to you by
	http://www.kycosoftware.com

	Copyright 2014 Cornelius Weidmann

	Distributed under the GPL

\***************************************/

(function(c){var x={preloadSelector:!0,truePercentage:!0,disableOverlay:!1,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:1E3,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},f={init:function(g){var a=c.extend({},x,g);return this.each(function(){function g(){a.debugMode&& (console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": preloading image elements..."),console.groupCollapsed("intervals"));a.forceSequentialLoad?function d(a){var h=m[a],D=c("<img>").attr("src",y(h.node));D.load(function(){t(h);++a<m.length&&d(a)}).error(function(){t(h);++a<m.length&&d(a);u(D,h)})}(0):m.forEach(function(a,l){var h=c("<img>").attr("src",y(a.node));h.load(function(){t(a)}).error(function(){t(a);u(h,a)})})}function u(a,d){d.node.addClass("kyco_preloader_not_found_error")}function t(b){v++; a.truePercentage?(n+=b.fileSize/p*100,v===q&&(n=100)):n=v/p*100;f(n,void 0,b);a.progressiveReveal&&r(b.node);a.afterEach.call(b.node)}function f(b,d,l){void 0===d&&a.debugMode&&console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": "+b.toFixed(2)+"%");d=void 0!==d?d:a.animateDuration;var h=0;a.truePercentage&&(void 0!==l&&(d=Math.round(l.fileSize/100)),100===b&&(d=a.animateDuration));w.stop();w.animate({width:b+"%"},{duration:d,easing:"linear",step:function(){h=z.width();A.children("span").html(Math.round(w.width()/ h*100))},complete:function(){A.children("span").html(Math.round(b));v===q&&(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": preloading image elements DONE"),console.groupEnd()),w.delay(100).queue(function(){a.showImagesBeforeComplete?(m.forEach(function(a){r(a.node)}),B.forEach(function(a){r(a)}),a.beforeComplete.call(this),e.animate({opacity:"0"},a.fadeOutDuration,function(){e.remove();a.onComplete.call(this)})):(a.beforeComplete.call(this),e.animate({opacity:"0"}, a.fadeOutDuration,function(){m.forEach(function(a){r(a.node)});B.forEach(function(a){r(a)});e.remove();a.onComplete.call(this)}))}))}})}function y(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function r(b){a.useOpacity?b.css("opacity","1"):b.show();b.attr("data-bg")&&b.css("background-image", b.attr("data-bg"))}var s=c(this),x=function(b){function d(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);l.push(a);0<a.children().length&&d(a)})}var l=[];0<b.children().length?(a.preloadSelector&&l.push(b),d(b)):a.preloadSelector&&l.push(b);return l}(s),m=[],B=[],v=0,q=0,n=0,p=0,E=0,e=c('<div id="kyco_preloader"></div>');a.showInContainer?(e.appendTo(s),s.css("position","relative"),e.css("position","absolute")):(e.appendTo("body"),e.css("position","fixed"));a.disableOverlay?e.css("height", "auto"):c('<div class="kyco_loader_overlay"></div>').appendTo(e);var C=c('<div class="kyco_loader"></div>').appendTo(e),A=a.hidePercentage?c('<div class="kyco_progress_notification">'+a.loaderText+"</div>").appendTo(C):c('<div class="kyco_progress_notification">'+a.loaderText+' <span class="kyco_progress_percentage">'+n+"</span>%</div>").appendTo(C),z=c('<div class="kyco_progress_bar"></div>').appendTo(C),w=c('<div class="kyco_progress_loaded"></div>').appendTo(z);a.silentMode&&e.hide();a.truePercentage&& f(1,3E3);if(a.debugMode){var k=(new Date).getTime();console.groupCollapsed("kycoPreload > ",s);console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": scanning DOM for image elements...");console.groupCollapsed("image elements")}x.forEach(function(b){b.is("img")||"none"!==b.css("background-image")&&-1==b.css("background-image").indexOf("gradient")?(a.preloadSelector&&a.showInContainer&&b===s?a.hideBackground&&b.attr("data-bg",b.css("background-image")).css("background-image","none"):a.useOpacity? b.css("opacity","0"):b.hide(),b={node:b,fileSize:0},a.debugMode&&console.log(b.node),m.push(b),q++):a.hideNonImageElements&&(a.useOpacity?b.css("opacity","0"):b.hide(),B.push(b))});a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": scanning DOM for image elements DONE"));a.truePercentage?(a.debugMode&&(console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": getting image sizes..."),console.groupCollapsed("image sizes")),m.forEach(function(b){function d(){E++; E===q&&(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": getting image sizes DONE")),g())}c.ajax({type:"HEAD",cache:!1,url:y(b.node),success:function(l,c,e){b.fileSize=parseInt(e.getResponseHeader("Content-Length"));p+=b.fileSize;a.debugMode&&console.log((b.fileSize/1E3).toFixed(2)+" KB \t"+(p/1E3).toFixed(2)+" KB total");d()},error:function(b,g,k){d();b="Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>";b+="1. Make sure your images exist.<br>"; b+="2. Make sure your image paths/urls are correct.<br>";b+="3. If you load images from a remote domain set <code>truePercentage: false</code>.<br><br>";b+="<button>Close</button>";A.addClass("error").html(b);z.addClass("error");a.fadeOutDuration=5E5;c("#kyco_preloader button").click(function(){e.remove()})}})})):(a.debugMode&&console.log((((new Date).getTime()-k)/1E3).toFixed(3)+": getting image sizes SKIPPED"),p=q,g())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(c,a){for(var f= 0,u=this.length;f<u;f++)f in this&&c.call(a,this[f],f,this)});c.fn.kycoPreload=function(g){if(f[g])return f[g].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof g&&g)c.error("Method "+g+" does not exist on jQuery.kycoPreload");else return f.init.apply(this,arguments)}})(jQuery);
